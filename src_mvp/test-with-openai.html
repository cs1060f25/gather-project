<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gatherly MVP - Real OpenAI Integration</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        // Real OpenAI API integration
        class RealSchedulingService {
            constructor(apiKey) {
                this.apiKey = apiKey;
                this.conversationHistory = [];
            }

            async processSchedulingRequest(userMessage) {
                this.conversationHistory.push({ role: 'user', content: userMessage });

                const systemPrompt = `You are a scheduling assistant for Gatherly. Your job is to extract meeting details from user requests and ensure ALL required information is collected before showing a review card.

## Required Information for ANY Meeting:
1. **Attendees** - Who is attending (names, emails if provided)
2. **Duration** - How long the meeting should be (in minutes)
3. **Method** - How they'll meet (Video call, Phone call, In-person)
4. **Location** - Where they'll meet (if in-person) or platform (if virtual)
5. **Time Preferences** - When they want to meet (date/time constraints)

## Your Process:
1. **Extract** what you can from the user's message
2. **Identify** what's missing from the 5 required fields
3. **Ask** for missing information conversationally (one question at a time)
4. **Only** show review card when ALL 5 fields are complete

Always respond with a valid JSON object following this exact format:
{
  "status": "incomplete" | "complete",
  "extracted": {
    "attendees": ["name1", "name2"] | null,
    "duration": 30 | null,
    "method": "Video call" | "Phone call" | "In-person" | null,
    "location": "Downtown Cafe" | "Zoom" | "Google Meet" | null,
    "timePreferences": "Tomorrow afternoon" | "Monday 2pm" | null
  },
  "missing": ["attendees", "duration", "method", "location", "timePreferences"],
  "nextQuestion": "Who would you like to meet with?",
  "reviewCard": null | {
    "attendees": ["Sarah Johnson"],
    "duration": 60,
    "method": "In-person",
    "location": "Downtown Cafe",
    "constraints": "Tomorrow afternoon preferred",
    "proposedSlots": ["Tomorrow at 1:00 PM", "Tomorrow at 2:00 PM", "Tomorrow at 3:00 PM"]
  }
}

Rules:
- Always ask for ONE missing piece at a time
- Be conversational and friendly
- Make reasonable assumptions (lunch = 60min, coffee = 30min, meeting = 30min)
- For in-person meetings, always ask for location
- For virtual meetings, suggest platform if not specified
- Generate 3 time slots based on their preferences`;

                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4',
                            messages: [
                                { role: 'system', content: systemPrompt },
                                ...this.conversationHistory
                            ],
                            temperature: 0.1,
                            max_tokens: 1000
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`OpenAI API error: ${response.status} - ${response.statusText}`);
                    }

                    const data = await response.json();
                    const assistantMessage = data.choices[0].message.content;
                    
                    this.conversationHistory.push({ role: 'assistant', content: assistantMessage });

                    // Parse JSON response
                    const schedulingResponse = JSON.parse(assistantMessage);
                    
                    return schedulingResponse;
                } catch (error) {
                    console.error('Error processing scheduling request:', error);
                    
                    return {
                        status: 'incomplete',
                        extracted: {
                            attendees: null,
                            duration: null,
                            method: null,
                            location: null,
                            timePreferences: null
                        },
                        missing: ['attendees', 'duration', 'method', 'location', 'timePreferences'],
                        nextQuestion: `I had trouble processing your request (${error.message}). Could you tell me who you want to meet with?`,
                        reviewCard: null
                    };
                }
            }
        }

        function App() {
            const [messages, setMessages] = useState([
                { id: 1, type: 'bot', text: 'Hi! I\'m here to help you schedule meetings. Just tell me who you want to meet with and when!' }
            ]);
            const [inputMessage, setInputMessage] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [apiKey, setApiKey] = useState('');
            const [schedulingService, setSchedulingService] = useState(null);
            const [showApiKeyInput, setShowApiKeyInput] = useState(true);

            const handleApiKeySubmit = (e) => {
                e.preventDefault();
                if (apiKey.trim()) {
                    setSchedulingService(new RealSchedulingService(apiKey.trim()));
                    setShowApiKeyInput(false);
                }
            };

            const handleChatSubmit = async (e) => {
                e.preventDefault();
                if (!inputMessage.trim() || !schedulingService) return;

                const userMessage = { id: Date.now(), type: 'user', text: inputMessage };
                setMessages(prev => [...prev, userMessage]);
                const currentInput = inputMessage;
                setInputMessage('');
                setIsProcessing(true);

                try {
                    const response = await schedulingService.processSchedulingRequest(currentInput);
                    
                    if (response.status === 'complete' && response.reviewCard) {
                        const botResponse = {
                            id: Date.now() + 1,
                            type: 'bot',
                            text: 'Perfect! I\'ve extracted the details from your request. Please review and confirm:',
                            reviewCard: response.reviewCard
                        };
                        setMessages(prev => [...prev, botResponse]);
                    } else {
                        const botResponse = {
                            id: Date.now() + 1,
                            type: 'bot',
                            text: response.nextQuestion || 'I need more information to schedule your meeting.'
                        };
                        setMessages(prev => [...prev, botResponse]);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    const botResponse = {
                        id: Date.now() + 1,
                        type: 'bot',
                        text: `I had trouble processing your request: ${error.message}`
                    };
                    setMessages(prev => [...prev, botResponse]);
                }
                
                setIsProcessing(false);
            };

            const handleConfirmEvent = () => {
                const confirmMessage = {
                    id: Date.now(),
                    type: 'bot',
                    text: 'Perfect! I\'ve created your meeting and sent invitations to all attendees. They\'ll receive an SMS with the meeting details.'
                };
                setMessages(prev => [...prev, confirmMessage]);
            };

            const handleEditEvent = () => {
                const editMessage = {
                    id: Date.now(),
                    type: 'bot',
                    text: 'What would you like to change? You can tell me and I\'ll update the meeting details.'
                };
                setMessages(prev => [...prev, editMessage]);
            };

            if (showApiKeyInput) {
                return (
                    <div style={{ 
                        minHeight: '100vh', 
                        display: 'flex', 
                        alignItems: 'center', 
                        justifyContent: 'center',
                        backgroundColor: '#f5f5f7',
                        fontFamily: 'system-ui, -apple-system, sans-serif',
                        padding: '20px'
                    }}>
                        <div style={{
                            backgroundColor: 'white',
                            padding: '2rem',
                            borderRadius: '12px',
                            boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)',
                            width: '100%',
                            maxWidth: '400px'
                        }}>
                            <h2 style={{ textAlign: 'center', marginBottom: '1rem' }}>Enter OpenAI API Key</h2>
                            <p style={{ color: '#666', marginBottom: '1rem', fontSize: '14px' }}>
                                Paste your OpenAI API key to test the real scheduling assistant:
                            </p>
                            <form onSubmit={handleApiKeySubmit}>
                                <input
                                    type="password"
                                    value={apiKey}
                                    onChange={(e) => setApiKey(e.target.value)}
                                    placeholder="sk-proj-..."
                                    style={{
                                        width: '100%',
                                        padding: '12px',
                                        border: '1px solid #ddd',
                                        borderRadius: '8px',
                                        marginBottom: '1rem',
                                        fontSize: '14px'
                                    }}
                                    required
                                />
                                <button
                                    type="submit"
                                    style={{
                                        width: '100%',
                                        padding: '12px',
                                        backgroundColor: '#007AFF',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '8px',
                                        fontSize: '16px',
                                        cursor: 'pointer'
                                    }}
                                >
                                    Start Testing
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div style={{ 
                    minHeight: '100vh', 
                    display: 'flex', 
                    alignItems: 'center', 
                    justifyContent: 'center',
                    backgroundColor: '#f5f5f7',
                    fontFamily: 'system-ui, -apple-system, sans-serif',
                    padding: '20px'
                }}>
                    <div style={{ width: '100%', maxWidth: '600px', height: '80vh', display: 'flex', flexDirection: 'column' }}>
                        {/* Header */}
                        <div style={{
                            padding: '1rem',
                            borderBottom: '1px solid #E5E5EA',
                            backgroundColor: 'white',
                            borderRadius: '12px 12px 0 0'
                        }}>
                            <h2 style={{ margin: 0, fontSize: '18px' }}>Gatherly MVP - Real OpenAI Integration</h2>
                            <p style={{ margin: '4px 0 0', fontSize: '14px', color: '#666' }}>Powered by GPT-4 for intelligent meeting extraction</p>
                        </div>

                        {/* Messages */}
                        <div style={{
                            flex: 1,
                            padding: '1rem',
                            backgroundColor: '#f8f9fa',
                            overflowY: 'auto',
                            display: 'flex',
                            flexDirection: 'column',
                            gap: '1rem'
                        }}>
                            {messages.map((message) => (
                                <div key={message.id} style={{
                                    display: 'flex',
                                    justifyContent: message.type === 'user' ? 'flex-end' : 'flex-start'
                                }}>
                                    <div style={{
                                        maxWidth: '80%',
                                        padding: '12px 16px',
                                        borderRadius: message.type === 'user' ? '18px 18px 4px 18px' : '18px 18px 18px 4px',
                                        backgroundColor: message.type === 'user' ? '#007AFF' : 'white',
                                        color: message.type === 'user' ? 'white' : '#333',
                                        boxShadow: '0 1px 2px rgba(0,0,0,0.1)'
                                    }}>
                                        {message.text}
                                        
                                        {/* Review Card */}
                                        {message.reviewCard && (
                                            <div style={{
                                                marginTop: '16px',
                                                padding: '16px',
                                                backgroundColor: '#f8f9fa',
                                                borderRadius: '12px',
                                                border: '1px solid #e9ecef'
                                            }}>
                                                <h4 style={{ margin: '0 0 12px', fontSize: '16px', fontWeight: '600' }}>Meeting Details</h4>
                                                
                                                <div style={{ marginBottom: '12px' }}>
                                                    <strong>Attendees:</strong> {message.reviewCard.attendees.join(', ')}
                                                </div>
                                                
                                                <div style={{ marginBottom: '12px' }}>
                                                    <strong>Duration:</strong> {message.reviewCard.duration} minutes
                                                </div>
                                                
                                                <div style={{ marginBottom: '12px' }}>
                                                    <strong>Method:</strong> {message.reviewCard.method}
                                                    {message.reviewCard.location && ` at ${message.reviewCard.location}`}
                                                </div>
                                                
                                                {message.reviewCard.constraints && (
                                                    <div style={{ marginBottom: '12px' }}>
                                                        <strong>Preferences:</strong> {message.reviewCard.constraints}
                                                    </div>
                                                )}
                                                
                                                <div style={{ marginBottom: '16px' }}>
                                                    <strong>Proposed Times:</strong>
                                                    <div style={{ marginTop: '8px' }}>
                                                        {message.reviewCard.proposedSlots.map((slot, i) => (
                                                            <div key={i} style={{
                                                                padding: '8px 12px',
                                                                margin: '4px 0',
                                                                backgroundColor: 'white',
                                                                border: '1px solid #dee2e6',
                                                                borderRadius: '6px',
                                                                fontSize: '14px'
                                                            }}>
                                                                {slot}
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                                
                                                <div style={{ display: 'flex', gap: '8px' }}>
                                                    <button
                                                        onClick={handleConfirmEvent}
                                                        style={{
                                                            flex: 1,
                                                            padding: '10px 16px',
                                                            backgroundColor: '#28a745',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px',
                                                            fontWeight: '600'
                                                        }}
                                                    >
                                                        ‚úì Confirm & Send Invites
                                                    </button>
                                                    <button
                                                        onClick={handleEditEvent}
                                                        style={{
                                                            flex: 1,
                                                            padding: '10px 16px',
                                                            backgroundColor: '#6c757d',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px'
                                                        }}
                                                    >
                                                        ‚úèÔ∏è Edit Details
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ))}
                            
                            {isProcessing && (
                                <div style={{ display: 'flex', justifyContent: 'flex-start' }}>
                                    <div style={{
                                        padding: '12px 16px',
                                        borderRadius: '18px 18px 18px 4px',
                                        backgroundColor: 'white',
                                        boxShadow: '0 1px 2px rgba(0,0,0,0.1)'
                                    }}>
                                        <span>ü§ñ Analyzing with GPT-4...</span>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Input */}
                        <div style={{
                            padding: '1rem',
                            borderTop: '1px solid #E5E5EA',
                            backgroundColor: 'white',
                            borderRadius: '0 0 12px 12px'
                        }}>
                            <form onSubmit={handleChatSubmit} style={{ display: 'flex', gap: '8px' }}>
                                <input
                                    type="text"
                                    value={inputMessage}
                                    onChange={(e) => setInputMessage(e.target.value)}
                                    placeholder="e.g., Schedule lunch with Sarah tomorrow at 1pm"
                                    disabled={isProcessing}
                                    style={{
                                        flex: 1,
                                        padding: '12px 16px',
                                        border: '1px solid #E5E5EA',
                                        borderRadius: '20px',
                                        fontSize: '16px',
                                        outline: 'none'
                                    }}
                                />
                                <button
                                    type="submit"
                                    disabled={!inputMessage.trim() || isProcessing}
                                    style={{
                                        padding: '12px 20px',
                                        backgroundColor: (!inputMessage.trim() || isProcessing) ? '#ccc' : '#007AFF',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '20px',
                                        cursor: (!inputMessage.trim() || isProcessing) ? 'not-allowed' : 'pointer',
                                        fontSize: '16px'
                                    }}
                                >
                                    Send
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
