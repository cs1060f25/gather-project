<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gatherly MVP Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        // Simple scheduling service for testing
        class TestSchedulingService {
            async processSchedulingRequest(userMessage) {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Simple parsing for demo
                const hasAttendees = /with\s+(\w+)/i.test(userMessage);
                const hasDuration = /lunch|coffee|meeting/i.test(userMessage);
                const hasTime = /tomorrow|today|monday|tuesday|wednesday|thursday|friday|at\s+\d/i.test(userMessage);
                
                if (hasAttendees && hasDuration && hasTime) {
                    return {
                        status: 'complete',
                        reviewCard: {
                            attendees: ['Sarah Johnson'],
                            duration: userMessage.toLowerCase().includes('lunch') ? 60 : 30,
                            method: userMessage.toLowerCase().includes('lunch') ? 'In-person' : 'Video call',
                            location: userMessage.toLowerCase().includes('lunch') ? 'Downtown Cafe' : 'Zoom',
                            constraints: 'Tomorrow afternoon preferred',
                            proposedSlots: [
                                'Tomorrow at 1:00 PM',
                                'Tomorrow at 2:00 PM', 
                                'Tomorrow at 3:00 PM'
                            ]
                        }
                    };
                } else {
                    let nextQuestion = 'I need more details. ';
                    if (!hasAttendees) nextQuestion += 'Who would you like to meet with? ';
                    if (!hasDuration) nextQuestion += 'What type of meeting? ';
                    if (!hasTime) nextQuestion += 'When would you prefer to meet?';
                    
                    return {
                        status: 'incomplete',
                        nextQuestion: nextQuestion
                    };
                }
            }
        }

        function App() {
            const [messages, setMessages] = useState([
                { id: 1, type: 'bot', text: 'Hi! I\'m here to help you schedule meetings. Just tell me who you want to meet with and when!' }
            ]);
            const [inputMessage, setInputMessage] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [schedulingService] = useState(() => new TestSchedulingService());

            const handleChatSubmit = async (e) => {
                e.preventDefault();
                if (!inputMessage.trim()) return;

                const userMessage = { id: Date.now(), type: 'user', text: inputMessage };
                setMessages(prev => [...prev, userMessage]);
                const currentInput = inputMessage;
                setInputMessage('');
                setIsProcessing(true);

                try {
                    const response = await schedulingService.processSchedulingRequest(currentInput);
                    
                    if (response.status === 'complete' && response.reviewCard) {
                        const botResponse = {
                            id: Date.now() + 1,
                            type: 'bot',
                            text: 'Perfect! I\'ve extracted the details from your request. Please review and confirm:',
                            reviewCard: response.reviewCard
                        };
                        setMessages(prev => [...prev, botResponse]);
                    } else {
                        const botResponse = {
                            id: Date.now() + 1,
                            type: 'bot',
                            text: response.nextQuestion || 'I need more information to schedule your meeting.'
                        };
                        setMessages(prev => [...prev, botResponse]);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    const botResponse = {
                        id: Date.now() + 1,
                        type: 'bot',
                        text: 'I had trouble processing your request. Could you tell me who you want to meet with and when?'
                    };
                    setMessages(prev => [...prev, botResponse]);
                }
                
                setIsProcessing(false);
            };

            const handleConfirmEvent = () => {
                const confirmMessage = {
                    id: Date.now(),
                    type: 'bot',
                    text: 'Perfect! I\'ve created your meeting and sent invitations to all attendees. They\'ll receive an SMS with the meeting details.'
                };
                setMessages(prev => [...prev, confirmMessage]);
            };

            const handleEditEvent = () => {
                const editMessage = {
                    id: Date.now(),
                    type: 'bot',
                    text: 'What would you like to change? You can tell me and I\'ll update the meeting details.'
                };
                setMessages(prev => [...prev, editMessage]);
            };

            return (
                <div style={{ 
                    minHeight: '100vh', 
                    display: 'flex', 
                    alignItems: 'center', 
                    justifyContent: 'center',
                    backgroundColor: '#f5f5f7',
                    fontFamily: 'system-ui, -apple-system, sans-serif',
                    padding: '20px'
                }}>
                    <div style={{ width: '100%', maxWidth: '600px', height: '80vh', display: 'flex', flexDirection: 'column' }}>
                        {/* Header */}
                        <div style={{
                            padding: '1rem',
                            borderBottom: '1px solid #E5E5EA',
                            backgroundColor: 'white',
                            borderRadius: '12px 12px 0 0'
                        }}>
                            <h2 style={{ margin: 0, fontSize: '18px' }}>Gatherly MVP - Schedule a Meeting</h2>
                            <p style={{ margin: '4px 0 0', fontSize: '14px', color: '#666' }}>Tell me who you want to meet with and when</p>
                        </div>

                        {/* Messages */}
                        <div style={{
                            flex: 1,
                            padding: '1rem',
                            backgroundColor: '#f8f9fa',
                            overflowY: 'auto',
                            display: 'flex',
                            flexDirection: 'column',
                            gap: '1rem'
                        }}>
                            {messages.map((message) => (
                                <div key={message.id} style={{
                                    display: 'flex',
                                    justifyContent: message.type === 'user' ? 'flex-end' : 'flex-start'
                                }}>
                                    <div style={{
                                        maxWidth: '80%',
                                        padding: '12px 16px',
                                        borderRadius: message.type === 'user' ? '18px 18px 4px 18px' : '18px 18px 18px 4px',
                                        backgroundColor: message.type === 'user' ? '#007AFF' : 'white',
                                        color: message.type === 'user' ? 'white' : '#333',
                                        boxShadow: '0 1px 2px rgba(0,0,0,0.1)'
                                    }}>
                                        {message.text}
                                        
                                        {/* Review Card */}
                                        {message.reviewCard && (
                                            <div style={{
                                                marginTop: '16px',
                                                padding: '16px',
                                                backgroundColor: '#f8f9fa',
                                                borderRadius: '12px',
                                                border: '1px solid #e9ecef'
                                            }}>
                                                <h4 style={{ margin: '0 0 12px', fontSize: '16px', fontWeight: '600' }}>Meeting Details</h4>
                                                
                                                <div style={{ marginBottom: '12px' }}>
                                                    <strong>Attendees:</strong> {message.reviewCard.attendees.join(', ')}
                                                </div>
                                                
                                                <div style={{ marginBottom: '12px' }}>
                                                    <strong>Duration:</strong> {message.reviewCard.duration} minutes
                                                </div>
                                                
                                                <div style={{ marginBottom: '12px' }}>
                                                    <strong>Method:</strong> {message.reviewCard.method}
                                                    {message.reviewCard.location && ` at ${message.reviewCard.location}`}
                                                </div>
                                                
                                                {message.reviewCard.constraints && (
                                                    <div style={{ marginBottom: '12px' }}>
                                                        <strong>Preferences:</strong> {message.reviewCard.constraints}
                                                    </div>
                                                )}
                                                
                                                <div style={{ marginBottom: '16px' }}>
                                                    <strong>Proposed Times:</strong>
                                                    <div style={{ marginTop: '8px' }}>
                                                        {message.reviewCard.proposedSlots.map((slot, i) => (
                                                            <div key={i} style={{
                                                                padding: '8px 12px',
                                                                margin: '4px 0',
                                                                backgroundColor: 'white',
                                                                border: '1px solid #dee2e6',
                                                                borderRadius: '6px',
                                                                fontSize: '14px'
                                                            }}>
                                                                {slot}
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                                
                                                <div style={{ display: 'flex', gap: '8px' }}>
                                                    <button
                                                        onClick={handleConfirmEvent}
                                                        style={{
                                                            flex: 1,
                                                            padding: '10px 16px',
                                                            backgroundColor: '#28a745',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px',
                                                            fontWeight: '600'
                                                        }}
                                                    >
                                                        ✓ Confirm & Send Invites
                                                    </button>
                                                    <button
                                                        onClick={handleEditEvent}
                                                        style={{
                                                            flex: 1,
                                                            padding: '10px 16px',
                                                            backgroundColor: '#6c757d',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            fontSize: '14px'
                                                        }}
                                                    >
                                                        ✏️ Edit Details
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ))}
                            
                            {isProcessing && (
                                <div style={{ display: 'flex', justifyContent: 'flex-start' }}>
                                    <div style={{
                                        padding: '12px 16px',
                                        borderRadius: '18px 18px 18px 4px',
                                        backgroundColor: 'white',
                                        boxShadow: '0 1px 2px rgba(0,0,0,0.1)'
                                    }}>
                                        <span>Thinking...</span>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Input */}
                        <div style={{
                            padding: '1rem',
                            borderTop: '1px solid #E5E5EA',
                            backgroundColor: 'white',
                            borderRadius: '0 0 12px 12px'
                        }}>
                            <form onSubmit={handleChatSubmit} style={{ display: 'flex', gap: '8px' }}>
                                <input
                                    type="text"
                                    value={inputMessage}
                                    onChange={(e) => setInputMessage(e.target.value)}
                                    placeholder="e.g., Schedule lunch with Sarah tomorrow at 1pm"
                                    disabled={isProcessing}
                                    style={{
                                        flex: 1,
                                        padding: '12px 16px',
                                        border: '1px solid #E5E5EA',
                                        borderRadius: '20px',
                                        fontSize: '16px',
                                        outline: 'none'
                                    }}
                                />
                                <button
                                    type="submit"
                                    disabled={!inputMessage.trim() || isProcessing}
                                    style={{
                                        padding: '12px 20px',
                                        backgroundColor: (!inputMessage.trim() || isProcessing) ? '#ccc' : '#007AFF',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '20px',
                                        cursor: (!inputMessage.trim() || isProcessing) ? 'not-allowed' : 'pointer',
                                        fontSize: '16px'
                                    }}
                                >
                                    Send
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
