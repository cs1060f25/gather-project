{% extends "base.html" %}

{% block title %}Gatherly - Prepare for Your Meeting{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h2 class="text-2xl font-bold mb-4">Prepare for Your Meeting</h2>
        <p class="text-gray-700 mb-6">
            Enter a name, job title, or company to find LinkedIn profiles and prepare for your upcoming meetings.
            This is a prototype using sample data - in a real implementation, this would connect to the LinkedIn API.
        </p>
        
        <div class="relative">
            <input 
                type="text" 
                id="searchInput" 
                placeholder="Search for a person..." 
                class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            >
            <div id="searchResults" class="hidden absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg">
                <!-- Search results will be populated here by JavaScript -->
            </div>
        </div>
    </div>

    <div id="recentSearches" class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-xl font-semibold mb-4">Recently Added Profiles</h3>
        <div id="recentProfiles" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Recent profiles will be loaded here by JavaScript -->
            <div class="text-center py-8 text-gray-500">
                <p>Search for profiles to see results here</p>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const recentProfiles = document.getElementById('recentProfiles');
    let searchTimeout;

    // Load recent profiles on page load
    loadRecentProfiles();

    // Handle search input
    searchInput.addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        const query = e.target.value.trim();
        
        if (query.length < 2) {
            searchResults.classList.add('hidden');
            return;
        }

        searchTimeout = setTimeout(() => {
            fetch('/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `query=${encodeURIComponent(query)}`
            })
            .then(response => response.json())
            .then(data => {
                displaySearchResults(data);
            });
        }, 300);
    });

    // Hide search results when clicking outside
    document.addEventListener('click', function(e) {
        if (!searchResults.contains(e.target) && e.target !== searchInput) {
            searchResults.classList.add('hidden');
        }
    });

    function displaySearchResults(profiles) {
        if (profiles.length === 0) {
            searchResults.innerHTML = '<div class="p-4 text-gray-500">No results found</div>';
            searchResults.classList.remove('hidden');
            return;
        }

        const resultsHtml = profiles.map(profile => `
            <a href="/profile/${profile.id}" class="block p-4 hover:bg-gray-50 border-b border-gray-100">
                <div class="flex items-center">
                    <div class="flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold">
                        ${profile.first_name[0]}${profile.last_name[0]}
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-gray-900">${profile.first_name} ${profile.last_name}</p>
                        <p class="text-sm text-gray-500">${profile.headline}</p>
                    </div>
                </div>
            </a>
        `).join('');

        searchResults.innerHTML = resultsHtml;
        searchResults.classList.remove('hidden');
    }

    function loadRecentProfiles() {
        fetch('/search')
            .then(response => response.json())
            .then(profiles => {
                if (profiles.length > 0) {
                    const recentHtml = profiles.map(profile => `
                        <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex items-center mb-3">
                                <div class="flex-shrink-0 h-12 w-12 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-lg font-bold">
                                    ${profile.first_name[0]}${profile.last_name[0]}
                                </div>
                                <div class="ml-3">
                                    <p class="font-medium">${profile.first_name} ${profile.last_name}</p>
                                    <p class="text-sm text-gray-600">${profile.headline}</p>
                                </div>
                            </div>
                            <a href="/profile/${profile.id}" class="text-blue-600 hover:underline text-sm">Prepare for meeting â†’</a>
                        </div>
                    `).join('');
                    recentProfiles.innerHTML = recentHtml;
                }
            });
    }
});
</script>
{% endblock %}
